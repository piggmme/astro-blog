---
title: 'Web Push | React + FCM êµ¬í˜„í•˜ê¸° (feat. pwa, service worker)'
layout: ../_MarkdownPostLayout.astro
pubDate: 2022-12-2
description: 'Web Push | React + FCM êµ¬í˜„í•˜ê¸° (feat. pwa, service worker)'
author: 'dev_hee'
image:
    url: 'https://www.elemental.agency/cms/resources/ckuploads/8Dxe3Wm5QOKM.png'
    alt: ''
tags: ["FrontEnd"]

---

## ğŸ“© Web Push

ì›¹ì—ì„œë„ ë„¤ì´í‹°ë¸Œ ì•±ì²˜ëŸ¼ í‘¸ì‹œ ì•ŒëŒì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì›¹ì˜ ì‚¬ìš©ì„±ì„ ë„¤ì´í‹°ë¸Œ ì•±ì²˜ëŸ¼ ê°œì„ í•˜ê¸° ìœ„í•´ì„œ ë‚˜ì˜¨ ê¸°ìˆ ì¸ PWA(Progressive Web Application)ì„ í™œìš©í•˜ë©´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ğŸš€ PWA

PWAëŠ” Progressive Web Applicationìœ¼ë¡œ, ì›¹ì´ **ì›¹ì˜ ì¥ì ê³¼ ë„¤ì´í‹°ë¸Œ ì•±ì˜ ì¥ì **ì„ ëª¨ë‘ ê°€ì§ˆìˆ˜ ìˆë„ë¡ ë‹¤ì–‘í•œ ê¸°ìˆ ë“¤ê³¼ í‘œì¤€ íŒ¨í„´ì„ ì‚¬ìš©í•´ ê°œë°œëœ ì›¹ ì•±ì„ ë§í•©ë‹ˆë‹¤.

PWA ëŠ” ì—¬ëŸ¬ ê°€ì§€ì˜ ê¸°ìˆ ì˜ ì§‘í•©ì²´ì´ë©°, ëŒ€í‘œì ì¸ ê¸°ìˆ ì—ëŠ” **ì˜¤í”„ë¼ì¸ì—ì„œ ë™ì‘, ì„¤ì¹˜, ë™ê¸°í™”, í‘¸ì‹œ ì•Œë¦¼ ë“±**ì´ ìˆìŠµë‹ˆë‹¤.

PWAì„ ê°œë°œí•˜ê¸° ìœ„í•´ì„œëŠ” **`Service Worker`** ì™€ **`Webp App Manifest`** ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

### â± ì„œë¹„ìŠ¤ì›Œì»¤ - Service Worker

#### ì›¹ í‘¸ì‹œ ì•Œë¦¼ - Web Push Notification 

ì„œë¹„ìŠ¤ì›Œì»¤ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë¡œ **ë¸Œë¼ìš°ì €ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ì‹œí‚¤ëŠ” ìŠ¤í¬ë¦½íŠ¸**ì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ focus ë˜ì–´ìˆì§€ ì•ŠëŠ” ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œë„ ì„œë¹„ìŠ¤ì›Œì»¤ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹¤í–‰ë˜ê³  ìˆì–´ì„œ ë„¤íŠ¸ì›Œí¬ì—ì„œ Push ë°©ì‹ìœ¼ë¡œ ì „ë‹¬ëœ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, PWAì˜ ì£¼ëœ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ì¸ **"í‘¸ì‹œ ì•Œë¦¼"** ì„ ì„œë¹„ìŠ¤ì›Œì»¤ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì˜¤í”„ë¼ì¸ì—ì„œ ë™ì‘ - Offline capabilities

ì„œë¹„ìŠ¤ì›Œì»¤ëŠ” ë¸Œë¼ìš°ì €ì™€ ë„¤íŠ¸ì›Œí¬ ì‚¬ì´ì—ì„œ **`í”„ë¡ì‹œ ì„œë²„` ì—­í• **ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ `fetch` ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ì„œë¹„ìŠ¤ì›Œì»¤ëŠ” ê·¸ ìš”ì²­ì— ëŒ€í•œ ìºì‹œë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ìºì‹œê°€ ìˆë‹¤ë©´ ë¸Œë¼ìš°ì €ì—ê²Œ ë°”ë¡œ ê·¸ ìºì‹œë¥¼ ì „ë‹¬í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ ê¸°ìˆ  ë•ë¶„ì— ì˜¤í”„ë¼ì¸ì—ì„œë„ ë™ì‘í•˜ëŠ” ì›¹ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, PWAì˜ ì£¼ëœ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ì¸ **"ì˜¤í”„ë¼ì¸ì—ì„œ ë™ì‘"** ì´ ì„œë¹„ìŠ¤ì›Œì»¤ì˜ í”„ë¡ì‹œ ì„œë²„ ì—­í• ì— ì˜í•´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ğŸ”– Web App Manifest

`Manifest` ëŠ” JSON íŒŒì¼ë¡œ, ì•±ì— ëŒ€í•œ ì˜µì…˜ë“¤ì„ ëª…ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•±ì˜ ì´ë¦„, ì•„ì´ì½˜, ìƒ‰ìƒê°’ ë“±ì´ í¬í•¨ë©ë‹ˆë‹¤. `Manifest` íŒŒì¼ì— ì •ì˜ëœ ê°’ë“¤ì€ ì•±ì´ ì„¤ì¹˜ ë˜ì—ˆì„ë•Œ ë³´ì—¬ì¤„ ì•±ì˜ ì•„ì´ì½˜ì´ë‚˜ ì´ë¦„ë“±ì„ ë‚˜íƒ€ë‚´ê²Œ ë©ë‹ˆë‹¤. 


## ğŸ¤“ Web Pushì˜ ë™ì‘ ë°©ì‹

ì›¹ í‘¸ì‹œëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ Push ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. 

### Pull vs. Push

#### Pull

í’€ ë°©ì‹ì€ ìš°ë¦¬ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì—ê²Œ `fetch` ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ ì˜ˆë¡œ ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ì—ê²Œ ë°ì´í„° ìš”ì²­ì„ ë³´ë‚´ë©´, ì„œë²„ê°€ ì´ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì¦‰ ë°ì´í„°ê°€ í•„ìš”í•œ ì¸¡ì—ì„œ ì„œë²„ì—ê²Œ ë¨¼ì € **ìš”ì²­ì„ ë³´ë‚´ëŠ” ë™ì‘ì´ ë°˜ë“œì‹œ ì„ í–‰**ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

#### Push

í‘¸ì‰¬ ë°©ì‹ì€ í’€ ë°©ì‹ê³¼ëŠ” ë°˜ëŒ€ë¡œ **ë°ì´í„°ë¥¼ ìš”ì²­í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤**. ê·¸ì € ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ **ë°ì´í„°ë¥¼ ë°€ì–´ ë„£ì–´ì£¼ëŠ”(push) ë°©ì‹**ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. 


### Web Push ì„œë¹„ìŠ¤ (feat. ì„œë¹„ìŠ¤ì›Œì»¤)

ì›¹ í‘¸ì‹œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” **ì„œë²„ì™€ ë¸Œë¼ìš°ì €**ë§Œ í•„ìš”í•œ `fetch` ë°©ì‹ê³¼ëŠ” ë‹¤ë¥´ê²Œ, **"í‘¸ì‹œ ì„œë¹„ìŠ¤"**ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.

ì›¹ í‘¸ì‹œ ì„œë¹„ìŠ¤ëŠ” **ì„œë²„ê°€ ë³´ë‚¸ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ì•„ì„œ ë¸Œë¼ìš°ì €ì—ê²Œ ì „ë‹¬**í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì›¹ í‘¸ì‹œ ì„œë¹„ìŠ¤ëŠ” ì•ì—ì„œ ì„¤ëª…í•œ **ì„œë¹„ìŠ¤ì›Œì»¤**ë¥¼ í†µí•´ì„œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, ì„œë¹„ìŠ¤ì›Œì»¤ ìŠ¤í¬ë¦½íŠ¸ì— ì„œë²„ì—ì„œ ë³´ë‚¸ ì•Œë¦¼ì„ ë°›ì•„ì„œ ë¸Œë¼ìš°ì €ì—ê²Œ ì „ë‹¬í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.


## ğŸ”¥ FCM (Firebase Cloud Message)

ì„œë²„ì—ì„œ í‘¸ì‹œ ë©”ì‹œì§€ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚´ê¸° ìœ„í•´ì„œëŠ” **"ì›¹ í‘¸ì‹œ í”„ë¡œí† ì½œ"** ë°©ì‹ì— ë”°ë¼ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•´ì•¼í•©ë‹ˆë‹¤. ì›¹ í‘¸ì‹œ í”„ë¡œí† ì½œì€ í‘¸ì‹œ ì•Œë¦¼ì„ ìˆ˜ì‹ í•˜ëŠ” ë¸Œë¼ìš°ì €ì™€ ë°œì†¡í•˜ëŠ” ì„œë²„ê°€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•´ ì •í•´ë†“ì€ ê·œì•½ì…ë‹ˆë‹¤. ë³´ì•ˆì„ ìœ„í•´ì„œ VAPID ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ ë©”ì‹œì§€ë¥¼ ì•”í˜¸í™” í•´ì•¼í•©ë‹ˆë‹¤.

ì§ì ‘ ì›¹ í‘¸ì‹œ í”„ë¡œí† ì½œ ë°©ì‹ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ì–´ë µìŠµë‹ˆë‹¤. ë‹¤í–‰íˆ ì›¹ í‘¸ì‹œ í”„ë¡œí† ì½œ í‘œì¤€ì— ë§ê²Œ êµ¬í˜„ë˜ì–´ ìˆëŠ” ì—¬ëŸ¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ì¡´ì¬í•˜ë©°, ë³¸ë¬¸ì—ì„œëŠ” FCMì„ ì†Œê°œí•˜ë ¤ê³  í•©ë‹ˆë‹¤.

FCMì€ Firebase Cloud Messageë¡œ íŒŒì´ì–´ë² ì´ìŠ¤ ê¸°ë°˜ ì›¹ í‘¸ì‹œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
FCMì€ [firebase documents](https://firebase.google.com/docs/cloud-messaging)ì— ìì„¸íˆ ì„¤ëª…ë˜ì–´ ìˆë‹¤. í•´ë‹¹ ë¬¸ì„œì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ FCM ì„ ì‚¬ìš©í•œ ì›¹ í‘¸ì‹œë¥¼ ë¦¬ì•¡íŠ¸ì—ì„œ êµ¬í˜„í•´ë´…ì‹œë‹¤.

> ì•ìœ¼ë¡œ ì„¤ëª…ë“œë¦´ FCM + CRA ì˜ˆì œ ì½”ë“œ ì „ë¬¸ì€ [ê¹ƒí—ˆë¸Œ ì½”ë“œ](https://github.com/kheeyaa/FCM-with-React/blob/main/src/firebase-messaging-sw.js)ë¥¼ ì°¸ê³ í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

### ì´ˆê¸° ì„¤ì •

#### CRA ì„¤ì¹˜

ë¨¼ì € ë¦¬ì•¡íŠ¸ë¥¼ create-react-app ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.


```
npx create-react-app test-messaging
```

#### firebase ì„¤ì¹˜

FCM ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” íŒŒì´ì–´ë² ì´ìŠ¤ë¥¼ ì„¤ì¹˜í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```
npm install firebase
```

#### firebase ì½˜ì†”ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±

íŒŒì´ì–´ë² ì´ìŠ¤ ì½˜ì†”ì—ì„œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤.

1. [firebase ì½˜ì†”](https://console.firebase.google.com/u/0/?hl=ko)ì— ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.

2. í”„ë¡œì íŠ¸ë¥¼ ì¶”ê°€í•˜ê¸° ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

3. í”„ë¡œì íŠ¸ ì´ë¦„ ì‘ì„±, êµ¬ê¸€ ì• ë„ë¦¬í‹±ìŠ¤(ì‚¬ìš© ì•ˆí•´ë„ ë¨) ì‚¬ìš©, êµ¬ê¸€ ì• ë„ë¦¬í‹±ìŠ¤ êµ¬ì„±ì— ê³„ì •ì„ ì„ íƒ(default account)í•œ ë’¤ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

4. `</>` ëª¨ì–‘ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/heelieben/post/2f2ae784-1c04-49c3-b8a5-3f365bb5e01e/image.png)


5. ì•± ì´ë¦„ì„ ë“±ë¡í•©ë‹ˆë‹¤. (í˜¸ìŠ¤íŒ… ì„¤ì • í•˜ì§€ ì•Šì•„ë„ ë¨)

6. Firebase SDK ì¶”ê°€ì—ì„œ `npm ì‚¬ìš©` ì„ ì²´í¬í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  firebase SDK ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.



### Firebase ë©”ì„œë“œ ì„¤ì •

ë³µì‚¬í•œ firebase SDK ë¥¼ ë¶™ì—¬ë„£ì€ `firebase-messaging-sw.js` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” main.js ë‚˜ App.js ì²˜ëŸ¼ ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸ì— import í•´ì¤ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì‚¬ìš©ë˜ëŠ” `key` ê°’ë“¤ì€ ì™¸ë¶€ë¡œ ë…¸ì¶œë˜ë©´ ë³´ì•ˆìƒ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

```js
// firebase-messaging-sw.js
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";


const firebaseConfig = {
  apiKey: <user-api-key>,
  authDomain: <user-auth-domain>,
  projectId: <user-project-id>,
  storageBucket:  <user-storage-bucket>,
  messagingSenderId:  <user-messaging-sender-id>,
  appId: <user-app-id>,
  measurementId: <user-measurement-id>,
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
```

#### VAPID í‚¤ ìê²© ì¦ëª… ì„¤ì •

ì•ì—ì„œ ì„¤ëª…í•˜ì˜€ë“¯ì´ Web Push í”„ë¡œí† ì½œ í‘œì¤€ì€ VAPID ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤. FCMì€ VAPID ì¸ì¦ì„ ì‰½ê²Œ ì œê³µí•´ì¤ë‹ˆë‹¤. ë”°ë¼ì„œ VAPID í‚¤ë¥¼ ë°œê¸‰ ë°›ì•„ì•¼ í•˜ë©°, í•´ë‹¹ í‚¤ëŠ” ì›¹ í‘¸ì‹œ ë©”ì‹œì§€ì˜ í† í°ì„ ë°œê¸‰ ë°›ëŠ”ë° ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ VAPID í‚¤ë¥¼ ë°œê¸‰ë°›ê¸° ìœ„í•´ ë‹¤ìŒì„ ì´í–‰í•©ë‹ˆë‹¤.

1. [firebase ì½˜ì†”](https://console.firebase.google.com/u/0/?hl=ko)ì— ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.

2. í”„ë¡œì íŠ¸ ê°œìš” ì˜† ê´€ë¦¬ ë²„íŠ¼ > í”„ë¡œì íŠ¸ ì„¤ì • > í´ë¼ìš°ë“œ ë©”ì‹œì§•ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.

3. ì›¹ í‘¸ì‹œ ì¸ì¦ì„œ ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤. (Generate Key Pair)
![](https://velog.velcdn.com/images/heelieben/post/fc1b98fc-3d1a-456d-b62a-b66dfef6a157/image.png)

4. ìƒì„±ëœ í‚¤ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. VAPID í‚¤ ë˜í•œ ë³´ì•ˆì„ ìœ„í•´ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

#### ì•±ì—ì„œ ì›¹ ìê²© ì¦ëª… êµ¬ì„±

ë°œê¸‰ ë°›ì€ VAPID í‚¤ë¥¼ `getToken` ë©”ì„œë“œì—ê²Œ ì „ë‹¬í•˜ì—¬ í† í°ì„ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
VAPID í† í°ì€ ë°±ì—”ë“œ ê°œë°œìê°€ í•„ìš”ë¡œ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ apië¡œ ì „ë‹¬í•˜ë©´ ë©ë‹ˆë‹¤.

```js
import { getToken } from 'firebase/messaging';

const token = await getToken(messaging, {
  vapidKey: process.env.REACT_APP_VAPID_KEY,
});
```

### Notification ê¶Œí•œ ì„¤ì •

![](https://velog.velcdn.com/images/heelieben/post/76132d85-2dc8-4a5e-ae91-ff21a970f040/image.png)


ë¸Œë¼ìš°ì €ì—ì„œ Notification [ì•Œë¦¼ì„ ë°›ì„ì§€ ê¶Œí•œ ì„¤ì •](https://firebase.google.com/docs/cloud-messaging/js/client#access_the_registration_token)ì´ í•„ìš”í•©ë‹ˆë‹¤.
`Notification.requestPermission` ìœ¼ë¡œ ì•Œë¦¼ ê¶Œí•œ ì„¤ì • íŒì—…ì„ ë…¸ì¶œí•©ë‹ˆë‹¤. ë§Œì•½ ì´ë¯¸ ê¶Œí•œì´ í—ˆìš©ëœ ê²½ìš°ì—” ë°”ë¡œ permissionì— "granted" ë˜ëŠ” "denied" ë¥¼ ë‹´ì•„ ë³´ë‚´ì¤ë‹ˆë‹¤. ì•„ë‹ˆë¼ë©´ ì‚¬ìš©ìê°€ ê¶Œí•œì„ í—ˆìš©/ì°¨ë‹¨ í•œ ë’¤ ê·¸ ê²°ê³¼("granted", "denied")ë¥¼ ë‹´ì•„ ë³´ë‚´ì¤ë‹ˆë‹¤.

```js
function requestPermission() {
  console.log("ê¶Œí•œ ìš”ì²­ ì¤‘...");
  Notification.requestPermission().then((permission) => {
    if (permission === "granted") {
      console.log("ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ë¨");

      // FCM ë©”ì„¸ì§€ ì²˜ë¦¬
    } else {
      console.log("ì•Œë¦¼ ê¶Œí•œ í—ˆìš© ì•ˆë¨");
    }
  });
}
```

ì£¼ì˜í•´ì•¼ í•  ì ì€, í•œë²ˆ `Notification.requestPermission` ë¡œ ë…¸ì¶œí•œ íŒì—…ì€ **[ì‚¬ìš©ìê°€ í—ˆìš©/ì°¨ë‹¨ í•˜ë©´ ë‹¤ì‹œ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ íŒì—… ë…¸ì¶œì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ì ](https://devjonas.medium.com/trigger-notification-popup-with-javascript-9f5849c2ee9c)**ì…ë‹ˆë‹¤.

ë§Œì•½ í† ê¸€ ë²„íŠ¼ì„ í†µí•´ ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ on/off í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ë°©ì‹ìœ¼ë¡œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

- ì„œë²„ì—ì„œ ì•Œë¦¼ì„ ë³´ë‚¼ì§€ ë§ì§€ë¥¼ on/off ìƒíƒœë¡œ ì €ì¥í•œë‹¤.
- ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œì€ í—ˆìš©ëœ ì±„, ì„œë²„ì¸¡ì— ì•Œë¦¼ì„ on/off í•˜ëŠ”ì§€ ì„¤ì •ë§Œ ë°”ê¿”ì¤€ë‹¤.

ì´ˆê¸°ì— ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ ì°¨ë‹¨í–ˆë‹¤ë©´, ì‚¬ìš©ìê°€ ì§ì ‘ ë¸Œë¼ìš°ì € ì„¤ì •ìœ¼ë¡œ ë“¤ì–´ê°€ ë³€ê²½í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ **í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ë¸Œë¼ìš°ì € ì„¤ì • ë§í¬ë¥¼ open í•´ì£¼ëŠ” ê²ƒì€ ë³´ì•ˆìƒ ê¸ˆì§€**ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ë¸Œë¼ìš°ì € ì„¤ì • ê°€ì´ë“œë¼ì¸ì„ ì œì‹œí•˜ëŠ” ë°©ë²•ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.


### Service Worker ì„¤ì •

ì›¹ í‘¸ì‹œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
ì„œë¹„ìŠ¤ì›Œì»¤ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì€ `public` í´ë”ì— `firebase-message-sw.js` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë”°ë¡œ ìƒì„±í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. íŒŒì¼ëª…ì´ ë°˜ë“œì‹œ `firebase-message-sw.js` ì´ì–´ì•¼ FCM ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](https://velog.velcdn.com/images/heelieben/post/26df9474-73ca-45fa-ab2e-405ac446f1b5/image.png)

> [ê¹ƒí—ˆë¸Œì—ì„œ ì„œë¹„ìŠ¤ì›Œì»¤ ì½”ë“œ ì „ë¬¸ì„ ì°¸ê³ í•˜ì„¸ìš”.](https://github.com/kheeyaa/FCM-with-React/blob/main/public/firebase-messaging-sw.js)


#### Service Worker ì„¤ì¹˜ ë° í™œì„±í™”

ì„œë¹„ìŠ¤ì›Œì»¤ ìŠ¤í¬ë¦½íŠ¸ê°€ ì„¤ì¹˜ë˜ê³  í™œì„±í™” ë˜ì—ˆëŠ”ì§€ "install" ê³¼ "activat" ì´ë²¤íŠ¸ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`self` ëŠ” `WorkerGlobalScope` ì¸í„°í˜ì´ìŠ¤ì˜ ì½ê¸° ì „ìš© í”„ë¡œí¼í‹°ë¡œ, [`WorkerGlobalScope` ìì²´ì˜ ì°¸ì¡°ê°’ ë°˜í™˜](https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/self)í•©ë‹ˆë‹¤. 

```js
self.addEventListener("install", function (e) {
  console.log("fcm sw install..");
  self.skipWaiting();
});

self.addEventListener("activate", function (e) {
  console.log("fcm sw activate..");
});
```
ì„œë¹„ìŠ¤ì›Œì»¤ ìŠ¤í¬ë¦½íŠ¸ì— ë°±ê·¸ë¼ìš´ë“œì¼ ë•Œì—ë„ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Web push ì•Œë¦¼ ë…¸ì¶œ

Web push ì•Œë¦¼ì„ "push" ì´ë²¤íŠ¸ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`e` ì´ë²¤íŠ¸ ê°ì²´ì˜ `data` í”„ë¡œí¼í‹°ì—ëŠ” ì›¹ í‘¸ì‹œ ì•Œë¦¼ì— ëŒ€í•œ ì˜µì…˜ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`self.registration.showNotification(title, options)` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ ì›¹ í‘¸ì‹œì— ëŒ€í•œ ì•Œë¦¼ì„ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ì›Œì»¤ëŠ” ë°±ê·¸ë¼ìš´ë“œ í™˜ê²½ì—ì„œë„ ë™ì‘í•˜ë¯€ë¡œ ë¸Œë¼ìš°ì €ê°€ focus ë˜ì–´ ìˆëŠ” ìƒíƒœê°€ ì•„ë‹ˆë”ë¼ë„ ì•Œë¦¼ì´ ë…¸ì¶œë©ë‹ˆë‹¤.

ë§Œì•½ ì›¹ í‘¸ì‹œ ì•Œë¦¼ì— ì´ë¯¸ì§€ê°€ ì‚½ì…ë˜ì—ˆìœ¼ë©´ í•œë‹¤ë©´, `options` ê°’ì— `icon` í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. 


```js
self.addEventListener("push", function (e) {
  if (!e.data.json()) return;

  const resultData = e.data.json().notification;
  const notificationTitle = resultData.title;
  const notificationOptions = {
    body: resultData.body,
    icon: resultData.image, // ì›¹ í‘¸ì‹œ ì´ë¯¸ì§€ëŠ” icon
    tag: resultData.tag,
  };

  self.registration.showNotification(notificationTitle, notificationOptions);
});
```

#### Web push ì•Œë¦¼ í´ë¦­ í•¸ë“¤ëŸ¬

ë§Œì•½ ì›¹ í‘¸ì‹œ ì•Œë¦¼ì„ í´ë¦­í–ˆì„ ë•Œ ì–´ë–¤ URL ì„ ì—´ì–´ì£¼ëŠ” ë“±ê³¼ ê°™ì€ ì¶”ê°€ì ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ì‹¶ë‹¤ë©´ "notificationclick" ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```js
self.addEventListener("notificationclick", function (event) {
  console.log("notification click");
  const url = "/";
  event.notification.close();
  event.waitUntil(clients.openWindow(url));
});
```

### Web Push ì•Œë¦¼ ë³´ë‚´ê¸°

ì´ì œ ì›¹ í‘¸ì‹œ ì•Œë¦¼ì„ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë³´ë‚´ë´…ì‹œë‹¤.

1. [firebase ì½˜ì†”](https://console.firebase.google.com/u/0/?hl=ko)ì— ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸í•©ë‹ˆë‹¤. 

2. ì™¼ìª½ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ì˜ ì°¸ì—¬ > Messaging

![](https://velog.velcdn.com/images/heelieben/post/8716e30f-d60a-4413-8bea-070d6dbdccc8/image.png)

3. ë©”ì¸ ì˜ì—­ì—ì„œ ì˜¤ë¥¸ìª½ ìƒë‹¨ì— "ìƒˆ ìº í˜ì¸" > "ì•Œë¦¼" ìƒì„±

4. ì•Œë¦¼ ì œëª©, í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, ì´ë¦„ì„ ì‘ì„±í•œ ë’¤ "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡" ë²„íŠ¼ í´ë¦­

5. FCM ë“±ë¡ í† í°ì„ ì¶”ê°€í•©ë‹ˆë‹¤. í•´ë‹¹ í† í°ì€ `getToken` ì„ í†µí•´ ë°œê¸‰ë°›ì€ í† í°ì…ë‹ˆë‹¤. ì¶”ê°€ í›„ "í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì•Œë¦¼ì´ ë³´ë‚´ì§‘ë‹ˆë‹¤. 




## ğŸ˜¢ Web Push ë””ìì¸ & í•œê³„ì 

Web pushì˜ ê²½ìš°ì—” Web API ì˜ Notification ë¥¼ ì‚¬ìš©í•´ì„œ ì•Œë¦¼ì„ ë„ìš°ëŠ”ë°,
ì´ api ëŠ” ì»¨í…ì¸  ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ë§Œ ìˆê³ , **ìŠ¤íƒ€ì¼ë§ì´ ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.
ì¦‰ OS ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ìŠ¤íƒ€ì¼ì´ ì ìš©ëœ ì±„ë¡œ ì•Œë¦¼ì´ ë³´ì—¬ì§ˆìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤.

ê·¸ ì™¸ì—ë„ ë‹¤ì–‘í•œ í•œê³„ì ì´ í•œê³„ì ì´ ë‹¤ìŒê³¼ ê°™ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

- ì œëª©, ë‚´ìš©ì˜ ê¸€ììˆ˜ ì œí•œ/ë§ì¤„ì„í‘œ ë“±ì˜ ìŠ¤íƒ€ì¼ë§ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ì•Œë¦¼ì— í‘œì‹œë˜ëŠ” URLì„ ìˆ¨ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë¸Œë¼ìš°ì € ì •ì±…ì— ì˜í•´ì„œ)
- ì•Œë¦¼ì„ í™•ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ì»¤ìŠ¤í…€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- Web Push ëŠ” ì´ì œ ì‚¬íŒŒë¦¬ì—ì„œ ì§€ì› ê°€ëŠ¥í•˜ì§€ë§Œ, FCM ì´ ì•„ì§ ì‚¬íŒŒë¦¬ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

## ğŸ“š ì›¹ í‘¸ì‹œ ê°œë°œì‹œ ì°¸ê³ í•˜ë©´ ì¢‹ì€ ì‚¬ì´íŠ¸

### Notification Examples

https://web-push-book.gauntface.com/demos/notification-examples/

í‘¸ì‹œ ì•Œë¦¼ì— ëŒ€í•œ ì˜ˆì œê°€ ì˜ ë‚˜ì™€ìˆëŠ” ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.
ë³¸ë¬¸ì—ì„œëŠ” ì„¤ëª…í•˜ì§€ ì•Šì€ `Action Buttons` ë“±ê³¼ ê°™ì€ ì—¬ëŸ¬ ê¸°ëŠ¥ë“¤ì— ëŒ€í•œ ì˜ˆì œë¥¼ ì§ì ‘ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### PWA articles

https://felixgerschau.com/tags/pwa/

ì›¹ í‘¸ì‹œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” PWA ê¸°ìˆ ì— ëŒ€í•œ ì•„í‹°í´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì›¹ í‘¸ì‹œ ì•Œë¦¼ì— ëŒ€í•´ ì˜ ì„¤ëª…ëœ ê¸€

https://geundung.dev/114

ì›¹ í‘¸ì‹œ ì•Œë¦¼ì— ëŒ€í•´ì„œ ê·¸ë¦¼ê³¼ ì˜ˆì œë¥¼ í†µí•´ì„œ ì˜ ì„¤ëª…ë˜ì–´ ìˆëŠ” ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.


> ì°¸ê³ 
- [ì›¹ í‘¸ì‹œ ì•Œë¦¼(Web Push Notification)](https://geundung.dev/114)
- [ervice Workers Explained - Introduction to the JavaScript API](https://felixgerschau.com/service-workers-explained-introduction-javascript-api/)
- [PWAì— ëŒ€í•œ ìƒê°](https://mozi.vercel.app/blog/thinking-about-pwa) 
- [firebase documents](https://firebase.google.com/docs/cloud-messaging)




