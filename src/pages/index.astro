---
import Card from '@/components/Card.astro'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { camelize } from '@/utils/string'

interface Post {
  frontmatter: {
    title: string
    tags: string[]
    pubDate: string
    image: {
      url: string
      alt?: string
    }
    bgcolor: string
    color: string
  }
  url?: string
}
const allPosts: Post[] = await Astro.glob('./posts/*/*.md')
const uniqueTags = [...new Set(allPosts.map(post => post.frontmatter.tags).flat())]
const tags = uniqueTags.map((tag) => {
  const filteredPosts = allPosts.filter(post => post.frontmatter.tags.includes(tag)) as Post[]
  filteredPosts.sort((a, b) => {
    const aDate = new Date(a.frontmatter.pubDate)
    const bDate = new Date(b.frontmatter.pubDate)
    return bDate.getTime() - aDate.getTime()
  })
  return {
    tag,
    posts: filteredPosts,
  }
})
---
<BaseLayout title='@dev.hee'>
  <section class='home-header'>
    <h1>@dev_hee</h1>
    <p>그림쟁이 개발자 데브희입니다. <br />저의 보조기억 장치에 오신 것을 환영합니다.</p>
  </section>

  {
    tags.map(({ tag, posts }) => (
      <section class='home-posts'>
        <h2>#{camelize(tag)}</h2>
        <ul>
          {posts.map(post => (
            <li>
              <Card
                as='a'
                href={post.url}
                class='card'
                style={{ background: `url("${post.frontmatter.image.url}") #fff`, backgroundSize: 'cover' }}
              >
                <div class='subtitle'>
                  <h3 class='title'>
                    <span class='highlight'>
                      {post.frontmatter.title}
                    </span>
                  </h3>
                </div>
              </Card>
            </li>
          ))}
        </ul>
      </section>
    ))
  }
</BaseLayout>

<style lang='scss'>
  .home-header {
    margin-bottom: 24px;
    padding: 36px;
    h1 {
      font-size: rem(48px);
      font-weight: 700;
    }
    p {
      font-size: rem(18px);
      font-weight: 300;
      line-height: 1.3;
    }
  }

  .home-posts{
    margin-bottom: 48px;
    box-sizing: border-box;

    h2 {
      padding-left: 36px;
      font-size: rem(24px);
      font-weight: 700;
    }

    ul {
      display: flex;
      gap: 24px;
      width: 100%;
      overflow-x: scroll;
      padding: 16px;
      padding-left: 36px;
      box-sizing: border-box;
    }

    .card {
      position: relative;
    }
    .title {
      font-size: rem(20px);
      color: white;
      font-size: rem(18px);
      font-weight: 600;
      text-align: center;
      bottom: 16px;
    }
    .highlight {
      background-color: black;
      font-size: inherit;
    }
    .subtitle{
      position: absolute;
      bottom: 16px;
      left: 50%;
      width: 100%;
      transform: translateX(-50%);
    }
  }
</style>
